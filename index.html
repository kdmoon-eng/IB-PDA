<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì…ê³  PDA ì‹œìŠ¤í…œ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { Camera, Package, Search, CheckCircle, AlertCircle, BarChart3, MapPin } = lucide;

        const WarehousePDAApp = () => {
            const [warehouseData, setWarehouseData] = useState([]);
            const [currentMode, setCurrentMode] = useState('scan');
            const [scanType, setScanType] = useState('barcode');
            const [scanInput, setScanInput] = useState('');
            const [searchResult, setSearchResult] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [actualQuantity, setActualQuantity] = useState('');
            const [actualLocation, setActualLocation] = useState('');
            const [isProcessed, setIsProcessed] = useState(false);
            const [csvUploaded, setCsvUploaded] = useState(false);
            
            const videoRef = useRef(null);
            const fileInputRef = useRef(null);
            const [isScanning, setIsScanning] = useState(false);

            // ìƒ˜í”Œ ë°ì´í„° (ì‹¤ì œ CSV ì—…ë¡œë“œ ì „ê¹Œì§€ ì‚¬ìš©)
            const sampleData = [
                {
                    "ì…ê³ ë²ˆí˜¸": "DSIR-ES2-0811-105122-4257",
                    "ê³ ê°ì‚¬": "ì •ìƒ˜ë¬¼ë·°í‹°",
                    "í’ˆëª…": "ì•„í‹°ìŠ¤íŠ¸ë“œë¡œì‰ë¦½íœìŠ¬#ì˜¤ë²„ë¸Œë¼ìš´",
                    "ë°”ì½”ë“œ": "8809826714335",
                    "ìˆ˜ëŸ‰": "720",
                    "ì†Œë¹„ê¸°í•œ": "2026-12-18",
                    "ì œì¡°ë¡œíŠ¸": "F19X001",
                    "íŒŒë ›ë„˜ë²„": "",
                    "PLT.NO": "250818-1",
                    "íŠ¹ì´ì‚¬í•­": "",
                    "ì ì¹˜ ë¡œì¼€ì´ì…˜": ""
                },
                {
                    "ì…ê³ ë²ˆí˜¸": "DSIR-ES2-0811-105122-4257",
                    "ê³ ê°ì‚¬": "ì •ìƒ˜ë¬¼ë·°í‹°",
                    "í’ˆëª…": "ì—ì„¼ì…œìŠ¤í‚¨ëˆ„ë”ì¿ ì…˜#í˜ì–´ë¼ì´íŠ¸",
                    "ë°”ì½”ë“œ": "8809467632272",
                    "ìˆ˜ëŸ‰": "240",
                    "ì†Œë¹„ê¸°í•œ": "2028-06-10",
                    "ì œì¡°ë¡œíŠ¸": "NEA",
                    "íŒŒë ›ë„˜ë²„": "",
                    "PLT.NO": "250818-2",
                    "íŠ¹ì´ì‚¬í•­": "",
                    "ì ì¹˜ ë¡œì¼€ì´ì…˜": "B11-402-05-0"
                },
                {
                    "ì…ê³ ë²ˆí˜¸": "DSIR-ES2-0811-105122-4257",
                    "ê³ ê°ì‚¬": "ì •ìƒ˜ë¬¼ë·°í‹°",
                    "í’ˆëª…": "ì—ì„¼ì…œìŠ¤í‚¨ëˆ„ë”ì¿ ì…˜#í•‘í¬ë¼ì´íŠ¸",
                    "ë°”ì½”ë“œ": "8809467634559",
                    "ìˆ˜ëŸ‰": "80",
                    "ì†Œë¹„ê¸°í•œ": "2028-05-22",
                    "ì œì¡°ë¡œíŠ¸": "BDA",
                    "íŒŒë ›ë„˜ë²„": "",
                    "PLT.NO": "250818-3",
                    "íŠ¹ì´ì‚¬í•­": "",
                    "ì ì¹˜ ë¡œì¼€ì´ì…˜": "B07-406-21-0"
                }
            ];

            useEffect(() => {
                // ìƒ˜í”Œ ë°ì´í„°ë¡œ ì‹œì‘
                setWarehouseData(sampleData);
            }, []);

            // CSV íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file && file.type === 'text/csv') {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const csvText = e.target.result;
                        Papa.parse(csvText, {
                            header: true,
                            skipEmptyLines: true,
                            complete: (results) => {
                                setWarehouseData(results.data);
                                setCsvUploaded(true);
                                setError('');
                                console.log('CSV íŒŒì¼ ë¡œë“œ ì™„ë£Œ:', results.data.length, 'ê°œ í•­ëª©');
                            },
                            error: (error) => {
                                setError('CSV íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
                            }
                        });
                    };
                    reader.readAsText(file);
                } else {
                    setError('CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                }
            };

            // ë°”ì½”ë“œ/ì…ê³ ë²ˆí˜¸ë¡œ ê²€ìƒ‰
            const searchItem = (searchValue, type) => {
                setIsLoading(true);
                setError('');
                
                try {
                    const searchKey = type === 'barcode' ? 'ë°”ì½”ë“œ' : 'ì…ê³ ë²ˆí˜¸';
                    const results = warehouseData.filter(item => {
                        const itemValue = item[searchKey]?.toString().trim();
                        return itemValue === searchValue.toString().trim();
                    });
                    
                    if (results.length > 0) {
                        setSearchResult(results[0]);
                        setActualQuantity(results[0]['ìˆ˜ëŸ‰'] || '');
                        setActualLocation(results[0]['ì ì¹˜ ë¡œì¼€ì´ì…˜'] || '');
                        setCurrentMode('result');
                    } else {
                        setError(`${type === 'barcode' ? 'ë°”ì½”ë“œ' : 'ì…ê³ ë²ˆí˜¸'}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                        setSearchResult(null);
                    }
                } catch (error) {
                    setError('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                } finally {
                    setIsLoading(false);
                }
            };

            // ì¹´ë©”ë¼ ìŠ¤ìº” ì‹œì‘
            const startCamera = async () => {
                try {
                    setIsScanning(true);
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    });
                    
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                        videoRef.current.play();
                    }
                } catch (error) {
                    setError('ì¹´ë©”ë¼ ì ‘ê·¼ ì‹¤íŒ¨. ìˆ˜ë™ ì…ë ¥ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                    setIsScanning(false);
                }
            };

            // ì¹´ë©”ë¼ ìŠ¤ìº” ì¤‘ì§€
            const stopCamera = () => {
                if (videoRef.current && videoRef.current.srcObject) {
                    const tracks = videoRef.current.srcObject.getTracks();
                    tracks.forEach(track => track.stop());
                    videoRef.current.srcObject = null;
                }
                setIsScanning(false);
            };

            // ìˆ˜ë™ ê²€ìƒ‰ ì‹¤í–‰
            const handleManualSearch = () => {
                if (!scanInput.trim()) {
                    setError('ê²€ìƒ‰ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                searchItem(scanInput.trim(), scanType);
            };

            // ì…ê³  ì™„ë£Œ ì²˜ë¦¬
            const handleProcessComplete = () => {
                setIsProcessed(true);
                console.log('ì…ê³  ì™„ë£Œ:', {
                    item: searchResult,
                    actualQuantity,
                    actualLocation
                });
            };

            // ìƒˆë¡œìš´ ìŠ¤ìº” ì‹œì‘
            const startNewScan = () => {
                setCurrentMode('scan');
                setScanInput('');
                setSearchResult(null);
                setError('');
                setActualQuantity('');
                setActualLocation('');
                setIsProcessed(false);
                stopCamera();
            };

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* í—¤ë” */}
                    <div className="bg-blue-600 text-white p-4 shadow-lg">
                        <h1 className="text-xl font-bold flex items-center gap-2">
                            <Package className="w-6 h-6" />
                            ì…ê³  PDA ì‹œìŠ¤í…œ
                        </h1>
                        <p className="text-blue-100 text-sm mt-1">
                            ì´ {warehouseData.length}ê°œ ìƒí’ˆ ë¡œë“œë¨
                            {csvUploaded && <span className="ml-2 bg-green-500 px-2 py-1 rounded text-xs">CSV ì—…ë¡œë“œë¨</span>}
                        </p>
                    </div>

                    <div className="p-4 max-w-md mx-auto">
                        {/* CSV ì—…ë¡œë“œ ì„¹ì…˜ */}
                        {!csvUploaded && (
                            <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                <h3 className="font-semibold text-yellow-800 mb-2">CSV íŒŒì¼ ì—…ë¡œë“œ</h3>
                                <p className="text-sm text-yellow-700 mb-3">
                                    ì‹¤ì œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. (í˜„ì¬ëŠ” ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš© ì¤‘)
                                </p>
                                <input
                                    ref={fileInputRef}
                                    type="file"
                                    accept=".csv"
                                    onChange={handleFileUpload}
                                    className="hidden"
                                />
                                <button
                                    onClick={() => fileInputRef.current?.click()}
                                    className="w-full bg-yellow-500 text-white p-2 rounded-lg hover:bg-yellow-600 transition-colors"
                                >
                                    CSV íŒŒì¼ ì„ íƒ
                                </button>
                            </div>
                        )}

                        {currentMode === 'scan' && (
                            <div className="space-y-4">
                                {/* ìŠ¤ìº” íƒ€ì… ì„ íƒ */}
                                <div className="bg-white rounded-lg p-4 shadow">
                                    <h2 className="font-semibold mb-3">ìŠ¤ìº” ëª¨ë“œ ì„ íƒ</h2>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button
                                            onClick={() => setScanType('barcode')}
                                            className={`p-3 rounded-lg border-2 transition-colors ${
                                                scanType === 'barcode' 
                                                    ? 'border-blue-500 bg-blue-50 text-blue-700' 
                                                    : 'border-gray-200 hover:border-gray-300'
                                            }`}
                                        >
                                            <BarChart3 className="w-6 h-6 mx-auto mb-1" />
                                            <div className="text-sm font-medium">ë°”ì½”ë“œ ìŠ¤ìº”</div>
                                        </button>
                                        <button
                                            onClick={() => setScanType('receipt')}
                                            className={`p-3 rounded-lg border-2 transition-colors ${
                                                scanType === 'receipt' 
                                                    ? 'border-green-500 bg-green-50 text-green-700' 
                                                    : 'border-gray-200 hover:border-gray-300'
                                            }`}
                                        >
                                            <Package className="w-6 h-6 mx-auto mb-1" />
                                            <div className="text-sm font-medium">ì…ê³ ë²ˆí˜¸ ìŠ¤ìº”</div>
                                        </button>
                                    </div>
                                </div>

                                {/* ì¹´ë©”ë¼ ìŠ¤ìº” ì˜ì—­ */}
                                <div className="bg-white rounded-lg p-4 shadow">
                                    <h3 className="font-semibold mb-3">
                                        {scanType === 'barcode' ? 'ë°”ì½”ë“œ' : 'ì…ê³ ë²ˆí˜¸'} ìŠ¤ìº”
                                    </h3>
                                    
                                    {!isScanning ? (
                                        <button
                                            onClick={startCamera}
                                            className="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center gap-2"
                                        >
                                            <Camera className="w-5 h-5" />
                                            ì¹´ë©”ë¼ ì‹œì‘
                                        </button>
                                    ) : (
                                        <div className="space-y-3">
                                            <video
                                                ref={videoRef}
                                                className="w-full h-48 bg-black rounded-lg object-cover"
                                                playsInline
                                            />
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={stopCamera}
                                                    className="flex-1 bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition-colors"
                                                >
                                                    ìŠ¤ìº” ì¤‘ì§€
                                                </button>
                                                <button
                                                    onClick={() => setCurrentMode('manual')}
                                                    className="flex-1 bg-gray-500 text-white p-2 rounded-lg hover:bg-gray-600 transition-colors"
                                                >
                                                    ìˆ˜ë™ ì…ë ¥
                                                </button>
                                            </div>
                                            <p className="text-sm text-gray-600 text-center">
                                                {scanType === 'barcode' ? 'ë°”ì½”ë“œ' : 'ì…ê³ ë²ˆí˜¸'}ë¥¼ ì¹´ë©”ë¼ì— ë§ì¶°ì£¼ì„¸ìš”
                                            </p>
                                        </div>
                                    )}
                                </div>

                                {/* ìˆ˜ë™ ì…ë ¥ ë²„íŠ¼ */}
                                <button
                                    onClick={() => setCurrentMode('manual')}
                                    className="w-full bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-colors flex items-center justify-center gap-2"
                                >
                                    <Search className="w-5 h-5" />
                                    ìˆ˜ë™ ì…ë ¥
                                </button>

                                {/* í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„° */}
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                    <h4 className="font-semibold text-blue-800 mb-2">ğŸ“ í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„°</h4>
                                    <div className="text-sm text-blue-700 space-y-1">
                                        <div><strong>ë°”ì½”ë“œ:</strong> 8809826714335</div>
                                        <div><strong>ì…ê³ ë²ˆí˜¸:</strong> DSIR-ES2-0811-105122-4257</div>
                                        <p className="text-xs mt-2">ìœ„ ê°’ë“¤ë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!</p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {currentMode === 'manual' && (
                            <div className="space-y-4">
                                <div className="bg-white rounded-lg p-4 shadow">
                                    <h2 className="font-semibold mb-3">
                                        {scanType === 'barcode' ? 'ë°”ì½”ë“œ' : 'ì…ê³ ë²ˆí˜¸'} ìˆ˜ë™ ì…ë ¥
                                    </h2>
                                    
                                    <div className="space-y-3">
                                        <input
                                            type="text"
                                            value={scanInput}
                                            onChange={(e) => setScanInput(e.target.value)}
                                            placeholder={scanType === 'barcode' ? 'ë°”ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”' : 'ì…ê³ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”'}
                                            className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            onKeyPress={(e) => e.key === 'Enter' && handleManualSearch()}
                                        />
                                        
                                        <div className="flex gap-2">
                                            <button
                                                onClick={handleManualSearch}
                                                disabled={isLoading}
                                                className="flex-1 bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2"
                                            >
                                                {isLoading ? (
                                                    <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
                                                ) : (
                                                    <Search className="w-5 h-5" />
                                                )}
                                                ê²€ìƒ‰
                                            </button>
                                            <button
                                                onClick={startNewScan}
                                                className="flex-1 bg-gray-500 text-white p-3 rounded-lg hover:bg-gray-600 transition-colors"
                                            >
                                                ì·¨ì†Œ
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {currentMode === 'result' && searchResult && (
                            <div className="space-y-4">
                                {/* ìƒí’ˆ ì •ë³´ */}
                                <div className="bg-white rounded-lg p-4 shadow">
                                    <div className="flex items-center justify-between mb-3">
                                        <h2 className="font-semibold text-green-600 flex items-center gap-2">
                                            <CheckCircle className="w-5 h-5" />
                                            ê²€ìƒ‰ ì™„ë£Œ
                                        </h2>
                                        {isProcessed && (
                                            <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-medium">
                                                ì²˜ë¦¬ì™„ë£Œ
                                            </span>
                                        )}
                                    </div>
                                    
                                    <div className="space-y-2 text-sm">
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">ì…ê³ ë²ˆí˜¸:</span>
                                            <span className="font-medium">{searchResult['ì…ê³ ë²ˆí˜¸']}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">ê³ ê°ì‚¬:</span>
                                            <span className="font-medium">{searchResult['ê³ ê°ì‚¬']}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">í’ˆëª…:</span>
                                            <span className="font-medium">{searchResult['í’ˆëª…']}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">ë°”ì½”ë“œ:</span>
                                            <span className="font-medium">{searchResult['ë°”ì½”ë“œ']}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">ì˜ˆì •ìˆ˜ëŸ‰:</span>
                                            <span className="font-medium text-blue-600">{searchResult['ìˆ˜ëŸ‰']}ê°œ</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">ì†Œë¹„ê¸°í•œ:</span>
                                            <span className="font-medium">{searchResult['ì†Œë¹„ê¸°í•œ']}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">ì œì¡°ë¡œíŠ¸:</span>
                                            <span className="font-medium">{searchResult['ì œì¡°ë¡œíŠ¸']}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-600">PLT.NO:</span>
                                            <span className="font-medium">{searchResult['PLT.NO']}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* ì‹¤ì œ ì…ê³  ì •ë³´ ì…ë ¥ */}
                                <div className="bg-white rounded-lg p-4 shadow">
                                    <h3 className="font-semibold mb-3 flex items-center gap-2">
                                        <MapPin className="w-5 h-5" />
                                        ì‹¤ì œ ì…ê³  ì •ë³´
                                    </h3>
                                    
                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                ì‹¤ì œ ì…ê³  ìˆ˜ëŸ‰
                                            </label>
                                            <input
                                                type="number"
                                                value={actualQuantity}
                                                onChange={(e) => setActualQuantity(e.target.value)}
                                                className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="ì‹¤ì œ ì…ê³ ëœ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                ì ì¹˜ ë¡œì¼€ì´ì…˜
                                            </label>
                                            <input
                                                type="text"
                                                value={actualLocation}
                                                onChange={(e) => setActualLocation(e.target.value)}
                                                className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="ì ì¹˜í•  ìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: B11-402-05-0)"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* ì•¡ì…˜ ë²„íŠ¼ */}
                                <div className="space-y-2">
                                    {!isProcessed ? (
                                        <button
                                            onClick={handleProcessComplete}
                                            className="w-full bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center gap-2"
                                        >
                                            <CheckCircle className="w-5 h-5" />
                                            ì…ê³  ì™„ë£Œ ì²˜ë¦¬
                                        </button>
                                    ) : (
                                        <div className="bg-green-50 border border-green-200 rounded-lg p-3 text-center">
                                            <CheckCircle className="w-6 h-6 text-green-500 mx-auto mb-1" />
                                            <p className="text-green-700 font-medium">ì…ê³ ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                                        </div>
                                    )}
                                    
                                    <button
                                        onClick={startNewScan}
                                        className="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition-colors"
                                    >
                                        ìƒˆë¡œìš´ ìŠ¤ìº” ì‹œì‘
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
                        {error && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-3 flex items-start gap-2 mt-4">
                                <AlertCircle className="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" />
                                <p className="text-red-700">{error}</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<WarehousePDAApp />, document.getElementById('root'));
    </script>
</body>
</html>